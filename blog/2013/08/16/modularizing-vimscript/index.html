<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Modularizing VimScript</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.16-DEV" />
    <link href="" rel="alternate" type="application/rss+xml" title="bling on software" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://bling.github.io/css/hc.css" rel="stylesheet">
    <link href="http://bling.github.io/css/custom.css" rel="stylesheet">
    <link href="http://bling.github.io/css/highlight.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    
    
  </head>
  <body>
    <div id = "wrapper">

      <div class="navbar navbar-default" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a href="http://bling.github.io/"><p class="navbar-brand">bling on software</p></a>
          </div>
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              
              
            </ul>
          </div>
        </div>
      </div>



      
      <div id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-brand">
            <a href="http://bling.github.io/">
              <h1 class="brand">bling on software</h1>
            </a>
            <a href="/about">
              <img src="https://pbs.twimg.com/profile_images/1188386482/Untitled_bigger.png" />
            </a>
            <h3>when pragmatism meets minimalism</h3>
          </li>

          <hr />

          <div id="social-wrapper">
            <li> <a href="https://github.com/bling"><i class="fa fa-github-square"></i> github</a> </li>
            <li> <a href="https://twitter.com/blingcoder"><i class="fa fa-twitter-square"></i> @twitter</a></li>
            <li> <a href="https://linkedin.com/in/baileyling"><i class="fa fa-linkedin-square"></i> linkedin</a> </li>
          </div>

          <hr />

          <li class="sidebar-tags">
            <div>
              <span>Tags</span>
              <a href="/post" style="float:right">show all</a>
            </div>
            <div>
              
              <a href="/tags/blend">blend</a>
              
              <a href="/tags/blogging">blogging</a>
              
              <a href="/tags/castle">castle</a>
              
              <a href="/tags/coding">coding</a>
              
              <a href="/tags/cqrs">cqrs</a>
              
              <a href="/tags/emacs">emacs</a>
              
              <a href="/tags/forex">forex</a>
              
              <a href="/tags/ioc">ioc</a>
              
              <a href="/tags/javascript">javascript</a>
              
              <a href="/tags/logging">logging</a>
              
              <a href="/tags/powershell">powershell</a>
              
              <a href="/tags/rx">rx</a>
              
              <a href="/tags/scm">scm</a>
              
              <a href="/tags/software-tools">software-tools</a>
              
              <a href="/tags/testing">testing</a>
              
              <a href="/tags/twitter">twitter</a>
              
              <a href="/tags/vim">vim</a>
              
              <a href="/tags/visual-studio">visual-studio</a>
              
            </div>
          </li>
        </ul>
        <footer>
          <p class="text-muted">&copy; bling on software 2016. All rights reserved. </p>
        </footer>

      </div>



      <div class="container">



<div class="article">
  <div class="article-title">Modularizing VimScript</div>
  <div class="meta">
    <small><i class="fa fa-calendar-o"></i> 2013-08-16</small>
    <div class="article-tags">
      
      <a href="/tags/vim">vim</a>
      
    </div>
  </div>
  <hr/>
  <div class="post">
    

<h1 id="the-prerequisites:63ea627920250852a8af5077bddb656f">The prerequisites</h1>

<p>First off, there are two very good resources that are required reading in addition to what&rsquo;s provided in the official documentation.  Steve Losh&rsquo;s <a href="http://learnvimscriptthehardway.stevelosh.com/">Learn Vim the Hard Way</a> is an excellent book and I highly recommend it.  The <a href="http://www.ibm.com/developerworks/library/l-vim-script-1/">IBM Series</a> by Dr. Damian Conway is another great resource.  Without these I would not have been able to do what I have achieved, so thanks to them!</p>

<h1 id="where-i-started:63ea627920250852a8af5077bddb656f">Where I started</h1>

<p>When I first wrote <a href="https://github.com/bling/vim-bufferline">vim-bufferline</a> and <a href="https://github.com/bling/vim-airline">vim-airline</a> I was very much a newbie Vim scripter and I tried to follow as many existing patterns as possible.  It was evident that the community at large had a very &ldquo;C-like&rdquo; mentality, in that most things were done with functions declared in the global scope (I don&rsquo;t know if this still holds true for modern C development, but as an expression I think people will get what I&rsquo;m saying).  Many of the older scripts (pre GitHub) tended to be large, single file plugins which lived under the <code>plugin</code> folder.  For example, <a href="http://www.vim.org/scripts/script.php?script_id=2438">EasyGrep</a> is a 3000+ line plugin that helps you search and replace in Vim.</p>

<p>Most tutorials also taught writing functions in this fashion (most likely due to simplicity).  For example, this is from <a href="http://www.ibm.com/developerworks/library/l-vim-script-1/">part 1</a> of the IBM developer series:</p>
<div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">function</span><span class="p">!</span> ToggleSyntax<span class="p">()</span>
   <span class="k">if</span> exists<span class="p">(</span><span class="s2">&quot;g:syntax_on&quot;</span><span class="p">)</span>
      <span class="nb">syntax</span> off
   <span class="k">else</span>
      <span class="nb">syntax</span> enable
   <span class="k">endif</span>
<span class="k">endfunction</span>
nmap <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> ;s :<span class="k">call</span> ToggleSyntax<span class="p">()&lt;</span>CR<span class="p">&gt;</span>
</code></pre></div>

<p>We all have to start somewhere, but what I found was that these patterns and practices followed beyond their original intention and into plugins.</p>

<p>I think part of the problem is that Vim has a very unique scoping system, in that you can scope variables to a script, window, or buffer, for example.  People ended up using this as a form of encapsulation:</p>
<div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">let</span> s:text <span class="p">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">function</span><span class="p">!</span> s:somefile#set_text<span class="p">(</span>val<span class="p">)</span>
  <span class="k">let</span> s:text <span class="p">=</span> <span class="k">a</span>:val
<span class="k">endfunction</span>

<span class="k">function</span><span class="p">!</span> <span class="k">g</span>:somefile#get_text<span class="p">()</span>
  <span class="k">return</span> s:text
<span class="k">endfunction</span>
</code></pre></div>

<p>The <code>g:</code> variables are your exposed public API, and the <code>s:</code> variables are private.  That&rsquo;s all good, but <em>everything is still global!</em></p>

<h1 id="where-i-am-now:63ea627920250852a8af5077bddb656f">Where I am now</h1>

<p>There is nothing particular wrong with the approach of using global variables and functions.  Many complex software systems have been designed this way with much success, and often times, they perform much faster than counterparts with &ldquo;objects&rdquo; and &ldquo;polymorphism&rdquo;.</p>

<p>Nonetheless, everything has pros and cons, and the cost of maintenance goes up when you have a bunch of global variables interacting with each other.</p>

<p>The more VimScript I wrote the more I sought for a way to manage complexity and splitting up my code into smaller, manageable pieces.</p>

<h1 id="modularizing-vimscript:63ea627920250852a8af5077bddb656f">Modularizing VimScript</h1>

<p>Let&rsquo;s take a look at how we can create an object that is transient, has state, and contains methods you can invoke, like any modern OOP language can do.</p>
<div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">function</span><span class="p">!</span> myobject#<span class="k">new</span><span class="p">()</span>
  <span class="k">let</span> obj <span class="p">=</span> {}
  <span class="k">let</span> obj._cats <span class="p">=</span> []

  <span class="k">function</span><span class="p">!</span> obj.add_cat<span class="p">()</span>
    <span class="k">call</span> add<span class="p">(</span>self._cats<span class="p">,</span> <span class="s1">&#39;(^.^)&#39;</span><span class="p">)</span>
  <span class="k">endfunction</span>

  <span class="k">function</span><span class="p">!</span> obj.meow<span class="p">()</span>
    <span class="k">for</span> <span class="k">cat</span> <span class="k">in</span> self._cats
      echo <span class="k">cat</span>
    <span class="k">endfor</span>
  <span class="k">endfunction</span>

  <span class="k">return</span> obj
<span class="k">endfunction</span>

<span class="c">&quot; somewhere else</span>
<span class="k">let</span> <span class="k">x</span> <span class="p">=</span> myobject#<span class="k">new</span><span class="p">()</span>
<span class="k">call</span> <span class="k">x</span>.add_cat<span class="p">()</span>
<span class="k">call</span> <span class="k">x</span>.meow<span class="p">()</span>
</code></pre></div>

<p>This might look familiar to some of you.  Yes, it&rsquo;s almost the same as the <a href="https://www.google.com/search?q=javascript+module+pattern">JavaScript Module Pattern</a>.  Unfortunately, closures are not supported, but otherwise all of the usual benefits apply here, mainly controlled visibility into private state <strong>and</strong> <strong><em>transience!</em></strong></p>

<p>You can even take this concept further and replicate &ldquo;static&rdquo; functions:</p>
<div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">function</span><span class="p">!</span> s:object#private_static<span class="p">()</span>
<span class="k">endfunction</span>

<span class="k">function</span><span class="p">!</span> <span class="k">g</span>:object#public_static<span class="p">()</span>
<span class="k">endfunction</span>

<span class="k">function</span><span class="p">!</span> <span class="k">g</span>:object#<span class="k">new</span><span class="p">()</span>
  <span class="k">let</span> obj <span class="p">=</span> {}

  <span class="k">function</span><span class="p">!</span> obj.public<span class="p">()</span>
  <span class="k">endfunction</span>

  <span class="k">function</span><span class="p">!</span> obj._private<span class="p">()</span>
  <span class="k">endfunction</span>

  <span class="k">return</span> obj
<span class="k">endfunction</span>
</code></pre></div>

<p>Yep, same story as JavaScript here &ndash; <code>_</code> variables/functions are &ldquo;private&rdquo;.</p>

<h1 id="where-from-here:63ea627920250852a8af5077bddb656f">Where from here?</h1>

<p>Does this mean we should throw out procedural programming and go full on object oriented?  Hell no.  <a href="http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/aop/framework/AbstractSingletonProxyFactoryBean.html">This</a> is what happens when you go too far!  But we should always take a look at what we&rsquo;re doing and use the best tool and technique for the job.  Sometimes that&rsquo;s procedural, other times it&rsquo;s object-oriented.  It pays to be flexible.</p>

  </div>
</div>




<div class="social-bar">
  <a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="blingcoder">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <g:plusone></g:plusone>
</div>

<ul class="pager">
   &nbsp;<li class="previous"><a href="http://bling.github.io/blog/2013/09/09/vim-in-emacs-bootstrap/"> Vim in Emacs Bootstrap</a></li>
   &nbsp;<li class="next"><a href="http://bling.github.io/blog/2013/07/30/1000-stars-in-1-month/"> 1000 stars in 1 month</a></li>
</ul>


<div id="disqus_thread"></div>
<script type="text/javascript">
 (function() {
   if (window.location.hostname === 'localhost')
     return;

   var disqus_shortname = 'blingdev';
   var disqus_identifier = 'http:\/\/bling.github.io\/blog\/2013\/08\/16\/modularizing-vimscript\/';
   var disqus_title = 'Modularizing VimScript';
   var disqus_url = 'http:\/\/bling.github.io\/blog\/2013\/08\/16\/modularizing-vimscript\/';
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>





    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>

    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38439430-2', 'auto');
ga('send', 'pageview');
</script>

  </body>
</html>

