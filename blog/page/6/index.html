
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>bling on software development</title>
  <meta name="author" content="Bailey Ling">

  
  <meta name="description" content="Let’s review the main Rx code from last time: 1
2
3
4
5
6
7
8
public IObservable&lt;string&gt; GetJsonStreams()
{ var request = GetRequest(); return &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bling.github.io/blog/page/6">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="bling on software development" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic,700italic|Ubuntu:300,400,500,700,300italic,400italic,500italic,700italic' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38439430-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">bling on software development</a></h1>
  
    <h2>when pragmatism meets minimalism</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:bling.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/27/building-real-time-push-app-with-rx-2/">Building a Real-time Push App With Silverlight: Part 2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-27T00:00:00-04:00" pubdate data-updated="true">Aug 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Let’s review the main Rx code from last time:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">GetJsonStreams</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="n">GetRequest</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">Observable</span><span class="p">.</span><span class="n">FromAsyncPattern</span><span class="p">&lt;</span><span class="n">WebResponse</span><span class="p">&gt;(</span><span class="n">request</span><span class="p">.</span><span class="n">BeginGetResponse</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="n">EndGetResponse</span><span class="p">)()</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">wr</span> <span class="p">=&gt;</span> <span class="n">wr</span><span class="p">.</span><span class="n">GetResponseStream</span><span class="p">())</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">str</span> <span class="p">=&gt;</span> <span class="n">Observable</span><span class="p">.</span><span class="n">FromAsyncPattern</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">[],</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;(</span><span class="n">str</span><span class="p">.</span><span class="n">BeginRead</span><span class="p">,</span> <span class="n">str</span><span class="p">.</span><span class="n">EndRead</span><span class="p">))</span>
</span><span class='line'>        <span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span><span class="n">ParseJson</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>One thing I didn’t like about this was that the web request object was created regardless of whether the Observable gets a subscription or not.  This is potentially wasted resources, and I wanted to refactor this to be completely lazy.</p>

<p>And with this I started to run into my first &ldquo;huh?&rdquo; moments with Rx: I blocked the UI thread.  How did I do that? I started down the path of exploring some more of the Rx methods, which lead me to <code>Create</code>, which lets you manually call <code>OnNext</code>.  With this train of thought, I came up with something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">return</span> <span class="n">Observable</span><span class="p">.</span><span class="n">Create</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="n">obs</span> <span class="p">=&gt;</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="n">GetRequest</span><span class="p">();</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="n">Observable</span><span class="p">.</span><span class="n">FromAsyncPattern</span><span class="p">&lt;</span><span class="n">WebResponse</span><span class="p">&gt;(</span><span class="n">request</span><span class="p">.</span><span class="n">BeginGetResponse</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="n">EndGetResponse</span><span class="p">)().</span><span class="n">First</span><span class="p">();</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">str</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="n">GetResponseStream</span><span class="p">();</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">Observable</span><span class="p">.</span><span class="n">FromAsyncPattern</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">[],</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;(</span><span class="n">str</span><span class="p">.</span><span class="n">BeginRead</span><span class="p">,</span> <span class="n">str</span><span class="p">.</span><span class="n">EndRead</span><span class="p">);</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">json</span> <span class="k">in</span> <span class="n">ParseJson</span><span class="p">(</span><span class="n">reader</span><span class="p">))</span>
</span><span class='line'>        <span class="n">obs</span><span class="p">.</span><span class="n">OnNext</span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">obs</span><span class="p">.</span><span class="n">OnCompleted</span><span class="p">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">str</span><span class="p">;</span>
</span><span class='line'>    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Great! The initialization of the web request only occurs when subscribed! And it will even dispose the stream (by returning <code>str</code>) upon unsubscription.  I ran the app and the UI thread immediately blocked.  What happened?</p>

<p>Rx has the concept of subscription and observation, and provides a way to subscribe and observe on different threads.  Here is the original code that subscribed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">s</span><span class="p">.</span><span class="n">GetJsonStreams</span><span class="p">()</span>
</span><span class='line'>   <span class="p">.</span><span class="n">ObserveOnDispatcher</span><span class="p">()</span>
</span><span class='line'>   <span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Text</span> <span class="p">=</span> <span class="n">x</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Can you spot the error? I explicitly told Rx to observe on the dispatcher thread, because I want the action inside <code>Subscribe</code> to be invoked on the UI thread, but I didn’t specify where I want to set up the subscription.  Since I left it out, it uses the current thread, which happens to be the UI thread.  To solve this, it’s as simple as doing this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">s</span><span class="p">.</span><span class="n">GetJsonStreams</span><span class="p">()</span>
</span><span class='line'>    <span class="p">.</span><span class="n">SubscribeOn</span><span class="p">(</span><span class="n">Scheduler</span><span class="p">.</span><span class="n">ThreadPool</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="n">ObserveOnDispatcher</span><span class="p">()</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Text</span> <span class="p">=</span> <span class="n">x</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>That’s it! Easy! This also follows one of the most important guidelines when using Rx: <em>Subscription and Observation should be done as late as possible</em>, typically just before the <code>Subscribe</code>.  Anything more and you’ll likely make Rx spawn more threads than are necessary or some other nasty bugs.  <a href="http://en.wikipedia.org/wiki/KISS_principle">KISS</a>!</p>

<p>Now with that out of the way, let’s replace the boring TextBlock with something more usable.  First, I need to parse all the JSON streams I’m getting into bindable models.  To do that, I upgraded my StreamReader component and threw in System.Json for some basic parsing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">TweetParser</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="kt">int</span> <span class="n">_stack</span><span class="p">;</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">readonly</span> <span class="n">StringBuilder</span> <span class="n">_sb</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Tweet</span><span class="p">&gt;</span> <span class="n">Parse</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">current</span> <span class="p">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>            <span class="n">_sb</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">current</span> <span class="p">==</span> <span class="sc">&#39;{&#39;</span><span class="p">)</span> <span class="n">_stack</span><span class="p">++;</span>
</span><span class='line'>            <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">current</span> <span class="p">==</span> <span class="sc">&#39;}&#39;</span><span class="p">)</span> <span class="n">_stack</span><span class="p">--;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">_stack</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;</span><span class="n">_sb</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">Tweet</span> <span class="n">tweet</span><span class="p">;</span>
</span><span class='line'>                <span class="kt">var</span> <span class="k">value</span> <span class="p">=</span> <span class="n">JsonValue</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">_sb</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="k">is</span> <span class="n">JsonObject</span> <span class="p">&amp;</span><span class="n">Tweet</span><span class="p">.</span><span class="n">TryParse</span><span class="p">((</span><span class="n">JsonObject</span><span class="p">)</span><span class="k">value</span><span class="p">,</span> <span class="k">out</span> <span class="n">tweet</span><span class="p">))</span>
</span><span class='line'>                    <span class="k">yield</span> <span class="k">return</span> <span class="n">tweet</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">_sb</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nothing overly complicated.  Next, the Tweet object:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Tweet</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">readonly</span> <span class="n">JsonObject</span> <span class="n">_json</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">TryParse</span><span class="p">(</span><span class="n">JsonObject</span> <span class="k">value</span><span class="p">,</span> <span class="k">out</span> <span class="n">Tweet</span> <span class="n">tweet</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">)</span> <span class="p">&amp;</span><span class="k">value</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">tweet</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Tweet</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">tweet</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="nf">Tweet</span><span class="p">(</span><span class="n">JsonObject</span> <span class="n">json</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_json</span> <span class="p">=</span> <span class="n">json</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Text</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_json</span><span class="p">[</span><span class="s">&quot;text&quot;</span><span class="p">].</span><span class="n">ToValueString</span><span class="p">();</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">ScreenName</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_json</span><span class="p">[</span><span class="s">&quot;user&quot;</span><span class="p">][</span><span class="s">&quot;screen_name&quot;</span><span class="p">].</span><span class="n">ToValueString</span><span class="p">();</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">TweetEx</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">ToValueString</span><span class="p">(</span><span class="k">this</span> <span class="n">JsonValue</span> <span class="n">s</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">ToString</span><span class="p">().</span><span class="n">Trim</span><span class="p">(</span><span class="sc">&#39;&quot;&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To keep things simple I’m only extracting the screen name and text.  I won’t bore you setting up the views since it’s just simple ListBox bound to an <code>ObservableCollection&lt;Tweet&gt;</code>, and a DataTemplate for Tweet.  When it’s all said and done, we see something like this:</p>

<p><img src="http://lh3.ggpht.com/-sVzoQRx_V2s/TlqFswXVhUI/AAAAAAAAAFc/d9nLfBSrARA/image_thumb3.png?imgmax=800" alt="img" /></p>

<p>Performance is still good at 2-5% CPU, even though we’re scrolling through 1000 items in near real-time.</p>

<p>Stay tuned for part 3, when we introduce Expression Blend and go into basics of UI design.  Also, most of this will hit GitHub very soon.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/26/building-real-time-push-app-with-rx-1/">Building a Real-time Push App With Silverlight: Part 1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-26T00:00:00-04:00" pubdate data-updated="true">Aug 26<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is the beginning of a multi-part series where I’ll be building an interactive application with Silverlight 5 (still beta as of this post).  It will be built from the ground up and designed predominantly from a “push data” point of view, where the application is reacting to events in real-time, rather than a more traditional “pulling” point of view.  This type of application has exploded with the popularity of social networking and has made a lot of the traditional methods of building applications obsolete.</p>

<p>The best example of this shift is from Twitter.  When it first came out, it was (and still is predominantly) a “pull” model.  You have 200 API requests an hour, and you pull Twitter whenever you want to check if there are tweets of people you follow.  That is changing with the <a href="https://dev.twitter.com/docs/streaming-api">Streaming API</a> where data is “pushed” to you as it comes.  This changes the way you write your code and requires a mind shift much like from for loops to LINQ.</p>

<p>The primary purpose of this series is build a real-time push application from beginning to end, and to show any problems I run along the way, and how I managed to solve them.  This will be my first attempt at building a Silverlight application as well as learning <a href="http://msdn.microsoft.com/en-us/data/gg577609">Reactive Extensions</a>, so I’m bound to run into newbie mistakes.  If you have any tips or pointers please let me know!</p>

<p>Also, rather than doing this from a purely technical point of view, I’m also going to put on my designer hat and talk about UI design, and make it look good with Expression Blend when I get to designing the UI in later parts of this series.  I feel that this is often overlooked and can result in a lot of wasted work and lead to frustration.</p>

<p>This first post will be to get up and running and connected to Twitter with the Streaming API. This was chosen primarily because it is so much data can be pushed through and it can be used to demonstrate how to write a high performance Silverlight application.  It’s one thing to write something maintainable, and another altogether to make it run fast as well.  I’ve worked on too many WPF projects where performance took a back seat, and in WPF particularly this tends to create some massive technical debt.  The Silverlight/WPF technology stack is an exception to the rule and you should definitely think about performance from the start.</p>

<p>Well let’s get started!  We will connect to Twitter, convert it to an Observable, and then display tweets on the UI.</p>

<p>First, let’s create our TwitterStream class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">TwitterStream</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">static</span> <span class="nf">TwitterStream</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// this allows http authentication to work</span>
</span><span class='line'>        <span class="n">WebRequest</span><span class="p">.</span><span class="n">RegisterPrefix</span><span class="p">(</span><span class="s">&quot;http://&quot;</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Browser</span><span class="p">.</span><span class="n">WebRequestCreator</span><span class="p">.</span><span class="n">ClientHttp</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">readonly</span> <span class="n">StreamParser</span> <span class="n">parser</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StreamParser</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Username</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Password</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="n">HttpWebRequest</span> <span class="nf">GetRequest</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="n">WebRequest</span><span class="p">.</span><span class="n">CreateHttp</span><span class="p">(</span><span class="s">&quot;http://stream.twitter.com/1/statuses/sample.json?delimited=length&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">request</span><span class="p">.</span><span class="n">UseDefaultCredentials</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>        <span class="n">request</span><span class="p">.</span><span class="n">Credentials</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NetworkCredential</span><span class="p">(</span><span class="n">Username</span><span class="p">,</span> <span class="n">Password</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">request</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">GetJsonStreams</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="n">GetRequest</span><span class="p">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Observable</span><span class="p">.</span><span class="n">FromAsyncPattern</span><span class="p">&lt;</span><span class="n">WebResponse</span><span class="p">&gt;(</span><span class="n">request</span><span class="p">.</span><span class="n">BeginGetResponse</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="n">EndGetResponse</span><span class="p">)()</span>
</span><span class='line'>            <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">wr</span> <span class="p">=&gt;</span> <span class="n">wr</span><span class="p">.</span><span class="n">GetResponseStream</span><span class="p">())</span>
</span><span class='line'>            <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">str</span> <span class="p">=&gt;</span> <span class="n">Observable</span><span class="p">.</span><span class="n">FromAsyncPattern</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">[],</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;(</span><span class="n">str</span><span class="p">.</span><span class="n">BeginRead</span><span class="p">,</span> <span class="n">str</span><span class="p">.</span><span class="n">EndRead</span><span class="p">))</span>
</span><span class='line'>            <span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span><span class="n">ParseJson</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">ParseJson</span><span class="p">(</span><span class="n">Func</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">[],</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;&gt;</span> <span class="n">reader</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">256</span><span class="p">];</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">bytesRead</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">while</span> <span class="p">((</span><span class="n">bytesRead</span> <span class="p">=</span> <span class="n">reader</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Length</span><span class="p">).</span><span class="n">Single</span><span class="p">())</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">json</span> <span class="k">in</span> <span class="n">parser</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">bytesRead</span><span class="p">))</span>
</span><span class='line'>                <span class="k">yield</span> <span class="k">return</span> <span class="n">json</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that’s all there is to it!  The most complicated part is probably parsing of the JSON documents themselves, which I refactored into its own class.  The algorithm in the parser is pretty primitive, as it just looks for opening { and closing } and calls that a document – nothing more, nothing less.  Note that this uses the deprecated basic HTTP authentication.  Sooner or later it will be shut down and OAuth will be required, so I will upgrade when that happens as I want to keep the amount of written code to a minimum.</p>

<p>Perhaps the more interesting bit is this part with Rx:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">Observable</span><span class="p">.</span><span class="n">FromAsyncPattern</span><span class="p">&lt;</span><span class="n">WebResponse</span><span class="p">&gt;(</span><span class="n">request</span><span class="p">.</span><span class="n">BeginGetResponse</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="n">EndGetResponse</span><span class="p">)()</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">wr</span> <span class="p">=&gt;</span> <span class="n">wr</span><span class="p">.</span><span class="n">GetResponseStream</span><span class="p">())</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">str</span> <span class="p">=&gt;</span> <span class="n">Observable</span><span class="p">.</span><span class="n">FromAsyncPattern</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">[],</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;(</span><span class="n">str</span><span class="p">.</span><span class="n">BeginRead</span><span class="p">,</span> <span class="n">str</span><span class="p">.</span><span class="n">EndRead</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span><span class="n">ParseJson</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The API takes some getting used to, but once you “tune in” things start to make sense.  The <code>FromAsyncPattern</code> essentially wraps the <a href="http://msdn.microsoft.com/en-us/library/ms228969.aspx">APM</a> pattern’s Begin/End calls into a single <code>Func&lt;&gt;</code>, which when invoked gets you the result as if you called End(), however without all the tedious AsyncCallback implementation.</p>

<p>The nice thing about this wrapper Func is that the code starts to look synchronous, even though it is using the ThreadPool behind the scenes.  Next, the response is projected into its response stream, which again is converted to another Observable for reading bytes from the stream until finally it goes into the <code>ParseJson</code> method which projects string results.  This is both good and bad.  Good in that it can make asynchronous code look short and succinct (in this example I’ve wrapped 2 APM pattern calls in 2 lines of code), bad in that anyone inexperienced with Rx will get lost pretty fast.</p>

<p>Rx thus far has been a fairly high learning curve.  Maybe it’s just me.  When I read about it from others, or from seminars, it all makes sense and I generally don’t have any questions.  Trying to use it directly is another story, as there are so many overloads it’s easy to get overwhelmed.  I feel like Intellisense is making things worse!</p>

<p>Carrying on, the code above actually doesn’t do anything yet.  First, you must Subscribe to an observable before it does something, similar to you must foreach on a IEnumerable before it starts pulling data.</p>

<p>To finish off, let’s create a simple Window with a TextBlock bound to a Text property.  This is the constructor:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="nf">MainPage</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="n">InitializeComponent</span><span class="p">();</span>
</span><span class='line'>   <span class="n">DataContext</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="kt">var</span> <span class="n">s</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterStream</span><span class="p">();</span>
</span><span class='line'>   <span class="n">s</span><span class="p">.</span><span class="n">Username</span> <span class="p">=</span> <span class="s">&quot;blingcoder&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">s</span><span class="p">.</span><span class="n">Password</span> <span class="p">=</span> <span class="s">&quot;1234567&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">s</span><span class="p">.</span><span class="n">GetJsonStreams</span><span class="p">()</span>
</span><span class='line'>       <span class="p">.</span><span class="n">ObserveOnDispatcher</span><span class="p">()</span>
</span><span class='line'>       <span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Text</span> <span class="p">=</span> <span class="n">x</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Perhaps one of the nicest features of Rx is automatic thread switching between background threads and UI threads.  Above, there is a call to <code>ObserveOnDispatcher</code>, which as the name implies it observes to events on the Dispatcher thread :&ndash;).  Rx automatically handles switching to the UI thread so when Subscribe occurs we’re on the UI thread.</p>

<p>Performance is also very good so far, only maxing out at 5% CPU for what appears to be a continuous flood of tweets from random people.</p>

<p>And there you have it!  A completely asynchronous streaming Twitter client in roughly 20 lines of code (minus the parsing).  Stay tuned for part 2&hellip;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/19/injecting-logger-instances-via-unity/">Injecting Logger Instances via Convention With Unity</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-19T00:00:00-04:00" pubdate data-updated="true">Aug 19<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Let’s say you have something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="n">MyClass</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">ILog</span> <span class="n">Logger</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And you simply want Unity to inject an instance of <code>ILog</code> such that its name is <code>requestingDependency.GetType().FullName</code>, which in this case would be <code>Full.Namespace.MyClass</code>.</p>

<p>I&rsquo;ll leave it up to the exercise of the reader, but if you search for &lsquo;log4net and Unity&rsquo; you will find some working solutions which IMO are way too long to solve this.  I have obviously taken for granted the features of Windsor and Autofac too much because I expected something like this to be easily done in 2-3 lines of code.</p>

<p>After a lot of cursing I&rsquo;ve come up with something that&rsquo;s almost as short and gets the job done:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">LoggingExtension</span> <span class="p">:</span> <span class="n">UnityContainerExtension</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Initialize</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">Strategies</span><span class="p">.</span><span class="n">AddNew</span><span class="p">(</span><span class="n">UnityBuildStage</span><span class="p">.</span><span class="n">PreCreation</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">class</span> <span class="nc">LogBuilderStrategy</span> <span class="p">:</span> <span class="n">BuilderStrategy</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">Stack</span> <span class="n">buildKeys</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Stack</span><span class="p">();</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">PreBuildUp</span><span class="p">(</span><span class="n">IBuilderContext</span> <span class="n">context</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">type</span> <span class="p">=</span> <span class="p">((</span><span class="n">NamedTypeBuildKey</span><span class="p">)</span><span class="n">context</span><span class="p">.</span><span class="n">BuildKey</span><span class="p">).</span><span class="n">Type</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">ILog</span><span class="p">))</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">buildKeys</span><span class="p">.</span><span class="n">Count</span> <span class="p">&lt;</span> <span class="m">1</span><span class="p">)</span>
</span><span class='line'>                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">&quot;Log instances cannot be resolved directly.&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="n">context</span><span class="p">.</span><span class="n">Existing</span> <span class="p">=</span> <span class="n">LogManager</span><span class="p">.</span><span class="n">GetLog</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">buildKeys</span><span class="p">.</span><span class="n">Peek</span><span class="p">());</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">buildKeys</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">PostBuildUp</span><span class="p">(</span><span class="n">IBuilderContext</span> <span class="n">context</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">buildKeys</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you noticed, I had to cast to <code>NamedTypeBuildKey</code>, which unfortunately means I’m still stuck with Unity 1.2&hellip;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/16/adding-scripting-to-your-tool-belt/">Adding Scripting to Your Tool Belt</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-16T00:00:00-04:00" pubdate data-updated="true">Aug 16<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the most important things for any developer is to be well rounded.  They should know about functional, imperative, object-oriented, aspect-oriented programming, among others.  They should know the difference between dynamic and static languages.  They should know the difference between scripting, interpreted, compiled languages.</p>

<p>Why?  It opens your mindset.  It lets you see things in a different light, which ultimately changes the way you will write your code, and for the better.</p>

<p>The best example is when C# introduced lambdas and LINQ.  All of a sudden, the masses saw the benefits of functional programming style and how it <em>greatly</em> makes code succinct.</p>

<p>Here, I give an example of what knowing a little about Powershell did to save me a lot of time.</p>

<p>I use git-tfs to make my day job a little less painful every day, because I cannot stand TFS, at all.  In their latest release, they decided not to tag every changeset.  I like my things consistent, so I decided to go back in history to untag all the changesets.</p>

<p>Unfortunately, git doesn&rsquo;t have a mass untag, and you must untag each branch individually with <code>git tag -d name_of_tag</code>.</p>

<p>This is how you do it with Powershell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="n">50000</span><span class="p">..</span><span class="n">40000</span> <span class="p">|</span> <span class="p">%</span> <span class="p">{</span> <span class="n">git</span> <span class="n">tag</span> <span class="n">-d</span> <span class="s2">&quot;tfs/default/C$_&quot;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>50000..40000 creates an list of numbers from 50,000 to 40,000, then it gets piped <code>|</code> into a foreach loop <code>%</code> to run the git tag command by generating the tag name with the current loop item <code>$_</code>.</p>

<p>Why was this awesome?  I didn&rsquo;t have to open up Visual Studio, or a text editor, or anything.  I just typed it into the shell.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/23/tools-i-use-to-do-what-i-do/">Tools I Use to Do What I Do</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-23T00:00:00-04:00" pubdate data-updated="true">Jun 23<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<p>It’s been a while since I last blogged, but I want to get back into it….I just haven’t thought about what I wanna blog about yet.&nbsp; I’m thinking of doing some sort of multi-part series on a topic but haven’t decided on what yet.&nbsp; Nonetheless, just to get the ball rolling again here’s a quick blog post on some of the tools I use to do my every day job that’s in addition to your typical .NET developer tool chain.</p> <p><strong>General</strong></p> <p><a href="http://www.tcbmi.com/strokeit/">StrokeIt</a>:&nbsp; Funny name aside, on any clean install of Windows this is the <strong>first</strong> thing I install.&nbsp; I load up IE and I download this, followed by Chrome/Firefox.&nbsp; It is a mouse gesture program that affects all of Windows.&nbsp; By holding down the right mouse button, and making gestures you can do common tasks like minimize (drag SW), maximize (drag NE), close (draw a C), and others.&nbsp; It’s much faster than clicking the minimize/maximize buttons.&nbsp; For web browsing, creating and close tabs are drag SE and drag NW respectively.&nbsp; Back is W.&nbsp; Forward is E.&nbsp; Working this way is faster than any keyboard shortcut.</p> <p><a href="http://sourceforge.net/projects/console/">Console2</a>:&nbsp; It’s not a necessity, but it’s nice to be able to use a console with a better looking font.&nbsp; You can easily customize to run another shell, and in my case I have Powershell as the shell.</p> <p><a href="http://virtuawin.sourceforge.net/">VirtuaWin</a>:&nbsp; Ironically I don’t use any virtual desktops, but this app creates a nice middle click on any window that lets you mark it as ‘always on top’.</p> <p><a href="http://www.vim.org/">Vim</a>:&nbsp; It was an awful, painful 2 weeks to learn this thing but I’m sure glad I did.</p> <p><strong>Development/Visual Studio</strong></p> <p><a href="http://www.jetbrains.com/resharper/">Resharper</a>:&nbsp; This one doesn’t need much mentioning as anyone serious about programming in .NET has either heard of it, use it, or use one of its competitors like <a href="http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/">CodeRush</a>.</p> <p><a href="http://visualstudiogallery.msdn.microsoft.com/465a0d53-5133-4edd-a0cd-94484fe3d853">AllMargins</a>:&nbsp; This hidden gem is an awesome extension has brings a bunch of very useful features to the editor.&nbsp; It brings structural highlighting, highlighting matching words under caret, and RockScroll inspired scroll bar, and it does it all with little to no cost in performance.</p> <p><a href="http://visualstudiogallery.msdn.microsoft.com/d0d33361-18e2-46c0-8ff2-4adea1e34fef/">Productivity Power Tools</a>:&nbsp; There’s only 2 that I use here: document tabs, and moving lines.&nbsp; All the rest are either eye candy, negligible enhancements, or just plain too slow to be any use in large solutions (solution navigator I’m looking at you!!).</p> <p><a href="http://visualstudiogallery.msdn.microsoft.com/1a67eee3-fdd1-4745-b290-09d649d07ee0">XAML Intellisense Presenter</a>:&nbsp; This is a must-have for anyone who works with XAML in VS regularly.&nbsp; Resharper 6 may soon make this obsolete, however…</p> <p><a href="http://wiki.sharpdevelop.net/ILSpy.ashx">ILSpy</a>/<a href="http://www.jetbrains.com/decompiler/">dotPeek</a>:&nbsp; Decompilers.&nbsp; ‘nuff said.</p> <p><a href="http://snoopwpf.codeplex.com/">Snoop</a>:&nbsp; Staple tool for WPF developers to inspect the visual/logical tree.&nbsp; There’s also <a href="http://wpfinspector.codeplex.com/">WPF Inspector</a> which has a much nicer UI, but unfortunately doesn’t perform as fast.</p> <p><strong>Profiling</strong></p> <p><a href="http://www.red-gate.com/products/dotnet-development/dotnet-developer-bundle/">ANTS</a>/<a href="http://www.jetbrains.com/profiler/">dotTrace</a>/<a href="http://www.yourkit.com/dotnet/download/">YourKit</a>/etc:&nbsp; I’ve used many performance/memory profilers, and those 3 are the ones I like the most.&nbsp; Unfortunately, they all do things the others don’t, and all these things are very useful, so you still end up needing to use all of them to fix the particular problem you’re working on.</p> <p><a href="http://msdn.microsoft.com/en-us/windows/hardware/gg463009">WinDbg</a>: It isn’t every day I use this, but I’m sure glad to know that such a thing exists and the amount of power it gives me.</p> <p><strong>Scripting</strong></p> <p><a href="http://powergui.org/index.jspa">PowerGUI</a>:&nbsp; Best tool I found for editing PowerShell.&nbsp; The intellisense is great and has all the things you were expect when debugging through scripts.</p> <p><strong>Miscellaneous</strong></p> <p><a href="http://www.baremetalsoft.com/baretail/">BareTail</a>:&nbsp; Amazing program which watches log files in real time and can highlight rows based on a search pattern.</p> <p><a href="http://technet.microsoft.com/en-us/scriptcenter/dd742419">PowerShell</a>/<a href="http://cygwin.org/">Cygwin</a>/<a href="http://www.mingw.org/wiki/MSYS">MSYS</a>:&nbsp; I used to be a Cygwin/MSYS user because back in the day I liked to install a different Linux distribution every week so I learned some basic Bash commands and that carried over to Windows.&nbsp; Since PowerShell now exists, we have a real shell in Windows, so I’ve switched over to learn it, since as a Windows developer it’s more applicable to the kind of work I do.</p> <p>&nbsp;</p> <p>And there’s more but that’s enough for now!</p>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>bling</div>
<div class='content'>
Actually, Cygwin/MSYS used to be in my tool chain, but I&#39;ve made an effort to learn PowerShell by making it my shell.<br /><br />I&#39;m still thrown off sometimes because PowerShell operates on objects, rather than text.  Sometimes this makes it easier, sometimes harder.  Grep comes to mind.<br /><br />Check out BareTail if you want to watch log files in real time.</div>
</div>
<div class='comment'>
<div class='author'>Mike McG</div>
<div class='content'>
Nice post! Gonna check out XAML Intellisense Presenter, All Margins, and PowerGUI.<br /><br />For Always on Top functionality, I&#39;ve relied on PowerMenu. It doesn&#39;t have the middle-click (gotta go through the app menu in the window chrome), but it also lets you Minimize to Tray. StexBar is also pretty neat-o, lets you create your own buttons on the Explorer button bar.<br /><br />Maybe due to my *nix background, I also install Cygwin (including sshd which allows me to use Cygwin through PuTTY rather than cmd.exe), grepWin (regular expression per-directory content search), and Tail for Win32 (to watch log files). (In addition to Tail I install Less for Windows and hook it up to StexBar, then use Shift+F to watch files).</div>
</div>
</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/7/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/10/16/emacs-as-my-evil-mode/">Emacs as my Leader: evil-mode</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/09/vim-in-emacs-bootstrap/">Vim in Emacs Bootstrap</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/16/modularizing-vimscript/">Modularizing VimScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/30/1000-stars-in-1-month/">1000 stars in 1 month</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/21/smart-tab-expansions-in-vim-with-expression-mappings/">Smart tab expansions in Vim with expression mappings</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/15/flight-of-an-open-source-project/">The flight of an open-source project</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/02/unite-dot-vim-the-plugin-you-didnt-know-you-need/">Unite.vim, The plugin you didn&#8217;t know you need</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/19/on-typescript/">On TypeScript</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/bling">@bling</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'bling',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Bailey Ling -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blingdev';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
